Deciphering the Barrier Function Macro before translating to Python


Variables:
Ba - Barrier attenuation (seems to be referenced in cell I8-I31 of ADm from Joel)
D4 - Detection Distance
b9 - Barrier number (0 or 1) //Guessing this means wether there is a barrier or not (binary decision)?
b7 - Distance from source m
b8 - height m
H2 - m Source Height detec   //of drone or object to be detected
H3 - m Listener Height  detec //of target who would be detecting the sound
T1 - Degree Celsius det
S3 - Propagation loss cumulative
S4 - Frequency
S8 - Propagation loss individual



Function Barrier()
  For I = 0 To 23   // for every cell in H8 to H31 in ADM model
    Ba(I) = -0.001  //The barrier attenuation will be -0.001
  Next I
  If b9 > 0 Then    //if there is a barrier
    If D4 >= b7 Then    //if the detection distance is greater than or equal to distance from source
      Hba = b8 - (H2 + b7 * (H3 - H2) / D4)     
        //Hba holds : "Mic height?" - ("Source height" + "distance from source" * ("Listener height" - "Source height") / "Detection Distance")
      X1 = Sqr(b7 * b7 + (b8 - H2) * (b8 - H2))
        //X1 holds : square root of ("distance from source" * "distance from source" + ("Mic height?" - "source height") * ("Mic height?" - "source height"))
      X1 = X1 + Sqr((D4 - b7) * (D4 - b7) + (b8 - H3) * (b8 - H3))
        //Value of X1 is added to itself, then added with : square root of (("Detection Distance" - "Distance from source") * ("Detection Distance" - "Distance from source") + ("Mic height" - "Listener Height") * ("Mic height" - "Listener Height")) 
      X1 = X1 - Sqr(D4 * D4 + (H3 - H2) * (H3 - H2))
        //New value of X1 is: It's prev value minus square root of: ("Detection Distance" * "Detection Distance" + ("Listener height" - "Source height") * ("Listener Height - "Source height"))
      Cs = 331.4 * Sqr(1 + T1 / 273.15)
        // Cs holds the value of 331.4 * square root of: (1 + "Degree Celsius temp" / 273.15) ------> is this for kelvin?
      For I = 0 To 23   //for all cells?
        If Hba < 0 Then
          X2 = 2 * X1 * S4(2) / Cs ' Fresnel number N   //X2 holds the value of: 2 * X1 * Frequency / Cs 
          X3 = Sqr(2 * Pi * Abs(X2))    //X3 holds the value of square root of : 2* Pi * Absolute value (Fresnel number X2)
          X2 = -X2  //X2 is assigned the value of -X2, where X2 is fresnel number calculated above
          If X2 <= -0.1916 Then     //If Fresnel Number is less than this number
            Ba(I) = -0.01   //Assign every cell this value
          Else
            Ba(I) = -(5 + 2 * TenDivLog10 * Log(X3 / Tan(X3))) - 0.01
                //Assign every cell this value (not sure exacly what this does though)
          End If
        Else ' Hba>=0
          X2 = 2 * X1 * S4(I) / Cs ' Fresnel number N   //X2 is given the value of: 2* (X1) * Frequency of each cell?
          X3 = Sqr(2 * Pi * Abs(X2))    //X3 is given the value of square root of: (2* Pi * Absolute Value of(X2))
          X2 = Exp(2 * X3)  //X2 is given the value of: 2 to the X3 power
          If X2 = 1 Then    //If X2 = 1
            Ba(I) = -5 - 0.01   //Every cell is given this value
          Else
            Ba(I) = -(5 + 2 * TenDivLog10 * Log(X3 * (X2 + 1) / (X2 - 1))) - 0.01   //every cell given this value (not sure what this calculation is doing)
            If Ba(I) < -20 Then Ba(I) = -20     //If value of each cell is less than -20, then just assign it a value of -20?
          End If
        End If
      Next I
    End If
  End If
  For I = 0 To 23   //For every cell
    S8(I) = Ba(I)   //Individual propagation loss is assigned the value of the barrier attenuation
    S3(I) = S3(I) + S8(I) // Cumulative propagation loss is sum total of Individual propogation loss
  Next I    //move onto next cell?
End Function




NOTES:
-Looping (0-23) corresponds with the 24 cells in the ADM model from joel H:8 to H:31 where the Ba is used
-Attenuation definition: The reduction of the force, effect or value of something
-Fresnel number refers to : The Fresnel number is a useful concept in physical optics. The Fresnel number establishes a 
    coarse criterion to define the near and far field approximations. Essentially, if Fresnel number is small – less than roughly 1 – 
    the beam is said to be in the far field.
-Can a Fresnel Number be negative?
